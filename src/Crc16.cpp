//#############################################################################
// Crc16.C
//
//
//
// Created: 27.04.2022
// History:
//
// (C) ce.tron Gesellschaft f�r Hard-& Softwaretechnik mbH
// Roentgenstrasse 104
// D-64291 Darmstadt
//#############################################################################



//-------------------------------------------------------------------
//
#include "Crc16.h"


//-------------------------------------------------------------------
//



#define CRC_POLY 0x8408

TCrc16::TCrc16()
{
  ResetCrc();
}

//-------------------------------------------------------------------
// CRC-16-Prüfsumme eines Array's berechnen
//-------------------------------------------------------------------
TCrc16::CRC16 TCrc16::DoCrc(unsigned char *data, int len)
{
  ResetCrc();

  int k;

  for (k = 0; k < len; k++)
  {
    DoStreamingCrc(data[k]);
  }
  return m_Crc;
}


//-------------------------------------------------------------------
//
void   TCrc16::ResetCrc(void)
{
  m_Crc = StartValue;
}

//-------------------------------------------------------------------
//
TCrc16::CRC16 TCrc16::GetCrc(void)
{
  return (m_Crc);
}

//-------------------------------------------------------------------
//
unsigned char    TCrc16::GetCrcH(void)
{
  return ((unsigned char)(m_Crc >> 8));
}

//-------------------------------------------------------------------
//
unsigned char    TCrc16::GetCrcL(void)
{
  return ((unsigned char)(m_Crc & 0xFF));
}

//-------------------------------------------------------------------
//
TCrc16::CRC16  TCrc16::DoStreamingCrc(unsigned char C)
{
  unsigned char  k;

  m_Crc ^= ((unsigned int) C);

  for (k = 0; k < 8; k++)
  {
    if ((m_Crc & 0x01) != 0)
    {
      m_Crc >>= 1;
      m_Crc ^= CRC_POLY;
    }
    else
    {
      m_Crc >>= 1;
    }
  }

  return (m_Crc);
}



//#############################################################################
//#############################################################################
//#############################################################################
